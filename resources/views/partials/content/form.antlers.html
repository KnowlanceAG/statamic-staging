{{ form:create in="{ form:handle }"
id="form"
class="flex flex-wrap form-self"
x-ref="form"
x-data="sending()"
@submit.prevent="sendForm()"
}}
    <div class="w-full grid md:grid-cols-12 gap-y-6 md:gap-x-6 pt-6 pb-12 px-2 sm:px-6 lg:pt-8 lg:pb-16 lg:px-8 bg-gray-200">
        {{# Honeypot spam protection. #}}
        <div class="hidden">
            <label class="font-bold" for="fax">Fax <sup class="text-notice-400">*</sup></label>
            <input class="form-input w-full" id="fax" type="fax" name="fax" tabindex="-1" autocomplete="off"/>
        </div>

        {{ fields }}
            <div class="flex flex-col space-y-4
                {{ width == '25' ?= 'md:col-span-3' }}
                {{ width == '33' ?= 'md:col-span-4' }}
                {{ width == '50' ?= 'md:col-span-6' }}
                {{ width == '66' ?= 'md:col-span-8' }}
                {{ width == '75' ?= 'md:col-span-9' }}
                {{ width == '100' ?= 'md:col-span-12' }}"
            >
                <label class="font-bold" for="{{ handle }}">{{ trans key="{display}" }} {{ if validate | contains:required }}<sup class="text-notice-400">*</sup>{{ /if }}</label>
                {{# Load notification when there is a validation error with the name field. #}}
                <template x-if="errors.{{ handle }}">
                    {{ partial src="components/notification" type="error" attribute="x-text='errors.{handle}'" }}
                </template>
                {{ field }}
            </div>
        {{ /fields }}

        <div class="md:col-span-12 flex justify-end">
            <button
            class="bg-orange-500 hover:bg-orange-700 px-10 py-3 mt-8 inline-block text-white font-300 uppercase rounded-sm hover:transition-colors hover:duration-200 hover:bg-opacity-95"
            type="submit">
                {{ if form.handle == 'autorenbewerbung'}}
                    Bewerbung absenden
                {{ elseif form.handle == 'anfrage'}}
                    Anfrage absenden
                {{ else }}
                    Absenden
                {{ /if }}
            </button>
        </div>

        <template x-if="success">
            {{
                partial
                src="components/notification"
                type="success"
                class="md:col-span-12"
                content="Vielen Dank, wir haben Ihre Nachricht erhalten und werden Sie so schnell wie m√∂glich kontaktieren."
            }}
        </template>
    </div>
{{ /form:create }}

{{ dynamic_token }}
<script>
    function sending() {
        return {
            error: false,
            errors: [],
            sending: false,
            success: false,
            sendForm() {
                console.log('in SendForm()');
                this.sending = true;

                // fetch(this.$refs.form.action, {
                fetch('https://gwriter.uscreen.me/!/cpssg/forms/anfrage', {
                    headers: {
                        'X-Requested-With' : 'XMLHttpRequest'
                    },
                    method: 'POST',
                    body: new FormData(this.$refs.form)})
                .then(res => res.json())
                .then(json => {
                    if (json['success']) {
                        this.errors = [];
                        this.success = true;
                        this.error = false;
                        this.sending = false;
                        this.$refs.form.reset();
                    }
                    if (json['error']) {
                        this.sending = false;
                        this.error = true;
                        this.success = false;
                        this.errors = json['error'];
                    }
                })
                .catch(err => {
                    err.text().then( errorMessage => {
                        this.sending = false
                        console.log('errorMessage')
                    })
                })
            }
        }
    }
</script>
